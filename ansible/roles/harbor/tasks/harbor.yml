---
# download harbor tarball
- name: create install dir1
  file:
    path: '{{ harbor_download_dir }}'
    state: directory
- name: Download tarball
  get_url:
    url: '{{ horbor_online_installer_url }}'
    dest: '{{ harbor_download_dir }}/{{ harbor_installer_tgz_name }}'
- name: create destination dir1
  file:
    path: '{{ harbor_dest_dir }}'
    state: directory
- name: Extract harbor_installer_tgz into /var/lib/foo
  unarchive:
    src: '{{ harbor_download_dir }}/{{ harbor_installer_tgz_name }}'
    dest: '{{ harbor_dest_dir }}'
    remote_src: yes
# Configure harbor.cfg;
- name: upload harbor.cfg from template
  template:
    src: harbor.cfg.j2
    dest: '{{ harbor_dest_dir }}/harbor/harbor.cfg'
    mode: 0644
    backup: yes
- name: replace adminserver env templates file
  template:
    src: adminserver/env.j2
    dest: '{{ harbor_dest_dir }}/harbor/common/templates/adminserver/env'
    mode: 0644
- name: replace adminserver entrypoint file
  copy:
    src: adminserver/start.sh
    dest: '{{ harbor_dest_dir }}/harbor/common/adminserver-start.sh'
    mode: 0755
- name: replace docker-compose file
  copy:
    src: docker-compose.yml
    dest: "{{ harbor_dest_dir }}/harbor/docker-compose.yml"
  register: compose_file
# # Run install.sh to install and start Harbor;
# - name: Run the install command.
#   become: True
#   become_method: 'sudo'
#   command: '{{ harbor_dest_dir }}/harbor/install.sh --with-clair --with-notary --ha'
